<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬åŠ¡ç”¨è½¦ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #2c3e50; }
        .card { 
            background: white; 
            border-radius: 8px; 
            padding: 20px; 
            margin: 20px 0; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button { 
            background: #3498db; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2980b9; }
        .api-test { margin: 20px 0; }
        .result { 
            background: #f8f9fa; 
            padding: 15px; 
            margin-top: 10px; 
            border-radius: 4px; 
            border-left: 4px solid #3498db;
        }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš— å…¬åŠ¡ç”¨è½¦ç®¡ç†ç³»ç»Ÿ</h1>
        
        <div class="card">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div class="api-test">
                <button onclick="testHealth()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
                <div id="healthResult" class="result"></div>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸ” ç”¨æˆ·è®¤è¯</h2>
            <div class="api-test">
                <h3>ç™»å½•æµ‹è¯•</h3>
                <div>
                    <input type="text" id="phone" placeholder="æ‰‹æœºå·" value="13800138000">
                    <input type="password" id="password" placeholder="å¯†ç " value="admin123">
                    <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
                </div>
                <div id="loginResult" class="result"></div>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸš˜ è½¦è¾†ç®¡ç†</h2>
            <div class="api-test">
                <button onclick="getVehicles()">è·å–è½¦è¾†åˆ—è¡¨</button>
                <div id="vehiclesResult" class="result"></div>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸ“ ç”¨è½¦ç”³è¯·</h2>
            <div class="api-test">
                <div>
                    <input type="text" id="applicantId" placeholder="ç”³è¯·äººID" value="admin001">
                    <input type="text" id="reason" placeholder="äº‹ç”±" value="æ‹œè®¿å®¢æˆ·">
                    <input type="number" id="peopleCount" placeholder="äººæ•°" value="3">
                    <select id="vehicleType">
                        <option value="small">å°è½¦</option>
                        <option value="business">å•†åŠ¡è½¦</option>
                        <option value="coach">å¤§å®¢è½¦</option>
                    </select>
                    <button onclick="submitApplication()">æäº¤ç”³è¯·</button>
                </div>
                <div id="applicationResult" class="result"></div>
                
                <div style="margin-top: 20px;">
                    <button onclick="getApplications()">è·å–æ‰€æœ‰ç”³è¯·</button>
                    <div id="applicationsResult" class="result"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        
        async function testHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                displayResult('healthResult', data);
            } catch (error) {
                displayError('healthResult', error);
            }
        }
        
        async function testLogin() {
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone, password })
                });
                const data = await response.json();
                displayResult('loginResult', data);
            } catch (error) {
                displayError('loginResult', error);
            }
        }
        
        async function getVehicles() {
            try {
                const response = await fetch(`${API_BASE}/api/vehicles`);
                const data = await response.json();
                displayResult('vehiclesResult', data);
            } catch (error) {
                displayError('vehiclesResult', error);
            }
        }
        
        async function submitApplication() {
            const now = new Date();
            const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
            
            const application = {
                applicant_id: document.getElementById('applicantId').value,
                reason: document.getElementById('reason').value,
                people_count: parseInt(document.getElementById('peopleCount').value),
                vehicle_type: document.getElementById('vehicleType').value,
                start_time: now.toISOString().slice(0, 19).replace('T', ' '),
                end_time: tomorrow.toISOString().slice(0, 19).replace('T', ' ')
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/applications`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(application)
                });
                const data = await response.json();
                displayResult('applicationResult', data);
            } catch (error) {
                displayError('applicationResult', error);
            }
        }
        
        async function getApplications() {
            try {
                const response = await fetch(`${API_BASE}/api/applications`);
                const data = await response.json();
                displayResult('applicationsResult', data);
            } catch (error) {
                displayError('applicationsResult', error);
            }
        }
        
        function displayResult(elementId, data) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        function displayError(elementId, error) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre style="color: red;">é”™è¯¯: ${error.message}</pre>`;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥
        window.onload = testHealth;
    </script>
</body>
</html>